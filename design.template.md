# 設計書: [プロジェクト名]

> **参照**: このドキュメントは `spec.md` に基づいて作成されています

## 概要

`spec.md` で定義された仕様を実現するための技術的な設計を記述します。

## アーキテクチャ

### システムアーキテクチャ

システム全体の構成を記述します。

```
[アーキテクチャ図をテキストまたは図で表現]

例:
┌─────────────┐
│   Client    │
└─────┬───────┘
      │
┌─────▼───────┐
│   Server    │
└─────┬───────┘
      │
┌─────▼───────┐
│  Database   │
└─────────────┘
```

**設計の理由**: なぜこのアーキテクチャを選択したのか、spec.mdのどの要件に対応しているかを記述

### コンポーネント構成

主要なコンポーネントとその責務を記述します。

#### [コンポーネント名1]

- **責務**: このコンポーネントが担う役割
- **対応する仕様**: `spec.md` の [該当セクション]
- **依存関係**: 依存する他のコンポーネント
- **技術**: 使用する技術やライブラリ

#### [コンポーネント名2]

- **責務**: このコンポーネントが担う役割
- **対応する仕様**: `spec.md` の [該当セクション]
- **依存関係**: 依存する他のコンポーネント
- **技術**: 使用する技術やライブラリ

## 技術スタック

### フロントエンド

| カテゴリ | 技術 | バージョン | 選定理由 |
|---------|------|-----------|---------|
| フレームワーク | [例: React] | [例: 18.x] | [spec.mdの要件を満たすため] |
| 状態管理 | [例: Redux] | [例: 4.x] | [理由] |
| スタイリング | [例: CSS Modules] | - | [理由] |
| テスティング | [例: Jest] | [例: 29.x] | [SDD原則に基づく] |

### バックエンド

| カテゴリ | 技術 | バージョン | 選定理由 |
|---------|------|-----------|---------|
| ランタイム | [例: Node.js] | [例: 18.x] | [理由] |
| フレームワーク | [例: Express] | [例: 4.x] | [理由] |
| ORM/ODM | [例: Prisma] | [例: 5.x] | [理由] |
| テスティング | [例: Jest] | [例: 29.x] | [SDD原則に基づく] |

### データベース

| カテゴリ | 技術 | バージョン | 選定理由 |
|---------|------|-----------|---------|
| DBMS | [例: PostgreSQL] | [例: 15.x] | [spec.mdのデータ要件に対応] |
| キャッシュ | [例: Redis] | [例: 7.x] | [パフォーマンス要件に対応] |

### インフラ・DevOps

| カテゴリ | 技術 | 選定理由 |
|---------|------|---------|
| ホスティング | [例: AWS/GCP/Azure] | [理由] |
| CI/CD | [例: GitHub Actions] | [理由] |
| コンテナ | [例: Docker] | [理由] |
| モニタリング | [例: CloudWatch] | [理由] |

### 開発ツール

| カテゴリ | 技術 | 選定理由 |
|---------|------|---------|
| パッケージマネージャー | [例: npm/yarn/pnpm] | [理由] |
| リンター | [例: ESLint] | [コード品質保証] |
| フォーマッター | [例: Prettier] | [コードスタイル統一] |
| バージョン管理 | [例: Git] | [チーム開発] |

## データベース設計

### テーブル設計

#### [テーブル名1]

**対応する仕様**: `spec.md` の [エンティティ名]

```sql
CREATE TABLE table_name (
  id VARCHAR(36) PRIMARY KEY,
  column1 VARCHAR(255) NOT NULL,
  column2 TEXT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_column1 (column1)
);
```

**カラム説明**:
- `id`: 一意識別子（UUID）
- `column1`: [カラムの説明]
- `column2`: [カラムの説明]

#### [テーブル名2]

**対応する仕様**: `spec.md` の [エンティティ名]

```sql
CREATE TABLE table_name2 (
  id VARCHAR(36) PRIMARY KEY,
  foreign_key_id VARCHAR(36),
  FOREIGN KEY (foreign_key_id) REFERENCES table_name(id)
);
```

### リレーション

```
[テーブル名1] 1 --- N [テーブル名2]
[テーブル名2] N --- N [テーブル名3]
```

## API設計

### エンドポイント一覧

**対応する仕様**: `spec.md` の [API仕様セクション]

#### [エンドポイント1]

```
GET /api/resource
```

**目的**: [このAPIの目的]

**リクエスト**:
```json
{
  "query": "検索クエリ",
  "limit": 10
}
```

**レスポンス**:
```json
{
  "data": [
    {
      "id": "uuid",
      "name": "名前"
    }
  ],
  "total": 100
}
```

**エラーレスポンス**:
```json
{
  "error": "エラーメッセージ",
  "code": "ERROR_CODE"
}
```

#### [エンドポイント2]

```
POST /api/resource
```

**目的**: [このAPIの目的]

**リクエスト**: [リクエストの形式]

**レスポンス**: [レスポンスの形式]

### 認証・認可

- **認証方式**: [例: JWT, OAuth 2.0]
- **認可方式**: [例: RBAC, ABAC]
- **対応する仕様**: `spec.md` の [セキュリティ要件]

## ディレクトリ構成

プロジェクトのディレクトリ構造を記述します。

```
project/
├── src/              # ソースコード
│   ├── components/   # UIコンポーネント
│   ├── services/     # ビジネスロジック
│   ├── models/       # データモデル
│   ├── utils/        # ユーティリティ関数
│   └── config/       # 設定ファイル
├── __tests__/        # テスト仕様（SDD）
│   ├── unit/         # ユニットテスト
│   ├── integration/  # 統合テスト
│   └── e2e/          # E2Eテスト
├── docs/             # ドキュメント
│   ├── spec.md       # 仕様書
│   ├── design.md     # 設計書（このファイル）
│   └── task.md       # タスク一覧
└── README.md         # プロジェクト概要
```

## セキュリティ設計

### 脅威モデル

**対応する仕様**: `spec.md` の [セキュリティ要件]

| 脅威 | 影響 | 対策 |
|------|------|------|
| [脅威1] | [影響度] | [実装する対策] |
| [脅威2] | [影響度] | [実装する対策] |

### セキュリティ対策

- **入力検証**: [実装方法]
- **XSS対策**: [実装方法]
- **CSRF対策**: [実装方法]
- **SQLインジェクション対策**: [実装方法]
- **認証情報の保護**: [実装方法]

## パフォーマンス設計

**対応する仕様**: `spec.md` の [パフォーマンス要件]

### 最適化戦略

- **キャッシュ戦略**: [実装方法]
- **データベースクエリ最適化**: [実装方法]
- **レスポンス圧縮**: [実装方法]
- **CDN利用**: [実装方法]

### パフォーマンス目標

| 指標 | 目標値 | 測定方法 |
|------|--------|---------|
| ページ読み込み時間 | [例: < 2秒] | [測定ツール] |
| API応答時間 | [例: < 200ms] | [測定ツール] |
| 同時接続数 | [例: 1000] | [負荷テスト] |

## エラーハンドリング設計

**対応する仕様**: `spec.md` の [エラーハンドリング]

### エラー分類

- **クライアントエラー (4xx)**: [処理方法]
- **サーバーエラー (5xx)**: [処理方法]
- **ビジネスロジックエラー**: [処理方法]

### ログ設計

```javascript
{
  "timestamp": "2024-01-01T00:00:00Z",
  "level": "ERROR",
  "message": "エラーメッセージ",
  "context": {
    "userId": "uuid",
    "action": "action_name"
  },
  "stackTrace": "..."
}
```

## テスト設計

**SDD原則に基づくテスト戦略**

### テスト戦略

| テストレベル | 目的 | ツール | カバレッジ目標 |
|-------------|------|--------|--------------|
| ユニットテスト | 個別機能の検証 | [例: Jest] | 80%以上 |
| 統合テスト | コンポーネント間連携 | [例: Jest] | 主要フロー100% |
| E2Eテスト | ユーザーシナリオ検証 | [例: Playwright] | 主要シナリオ100% |

### テストケース設計

**対応する仕様**: `spec.md` の [テストシナリオ]

各テストケースは、仕様書のテストシナリオに対応します。

```javascript
// 例: spec.mdのシナリオ1に対応
describe('[機能名]', () => {
  test('[シナリオ名]', () => {
    // 前提条件
    // 実行
    // 検証
  });
});
```

## デプロイ設計

### デプロイフロー

```
1. 開発 (feature branch)
   ↓
2. テスト (npm test)
   ↓
3. ステージング環境
   ↓
4. 本番環境
```

### 環境変数

| 変数名 | 説明 | 例 |
|--------|------|-----|
| DATABASE_URL | データベース接続文字列 | postgresql://... |
| API_KEY | 外部API認証キー | xxxx-yyyy-zzzz |
| NODE_ENV | 実行環境 | development/production |

## モニタリング・監視設計

### 監視項目

- **システムメトリクス**: CPU、メモリ、ディスク使用率
- **アプリケーションメトリクス**: リクエスト数、エラー率、レスポンスタイム
- **ビジネスメトリクス**: ユーザー数、トランザクション数

### アラート設定

| アラート | 条件 | 通知先 |
|---------|------|--------|
| エラー率上昇 | エラー率 > 5% | [通知先] |
| 応答時間劣化 | 応答時間 > 2秒 | [通知先] |

## スケーラビリティ設計

**対応する仕様**: `spec.md` の [パフォーマンス要件]

### スケーリング戦略

- **水平スケーリング**: [実装方法]
- **垂直スケーリング**: [実装方法]
- **データベーススケーリング**: [実装方法]

## 技術的負債と今後の改善

### 既知の制約

- [制約1]: [説明と将来の改善計画]
- [制約2]: [説明と将来の改善計画]

### 改善予定項目

- [ ] [改善項目1]: [優先度と理由]
- [ ] [改善項目2]: [優先度と理由]

## 参考資料

- [使用技術の公式ドキュメント]
- [アーキテクチャパターンの参考資料]
- [チーム内の設計ガイドライン]

## 変更履歴

| 日付 | バージョン | 変更内容 | 変更者 |
|------|-----------|---------|--------|
| YYYY-MM-DD | 1.0.0 | 初版作成 | [名前] |
| YYYY-MM-DD | 1.1.0 | [変更内容] | [名前] |
