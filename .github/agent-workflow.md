# SDDプロジェクト向けエージェントワークフロー

## 目的
このドキュメントは、このプロジェクトで作業するAIエージェント向けのガイダンスを提供します。

## プロジェクトタイプ
JestをテストフレームワークとしたNode.js使用のCLIアプリケーション

## 基本原則
1. **テスト駆動開発**: 常に実装前にテストを書く
2. **最小限の変更**: テストを通すために必要な最小限の変更を行う
3. **Red-Green-Refactor**: TDDサイクルを厳密に守る

## エージェントタスク

### タスク1: プロジェクトの探索
- `README.md`を読んでプロジェクトを理解する
- `__tests__/cli.spec.js`の既存のテストを確認する
- `src/cli.js`の既存の実装を確認する
- `npm test`を実行して現在のテスト状態を確認する

### タスク2: 新機能の追加
1. **要件を理解する** - イシュー/リクエストを注意深く読む
2. **テストを書く** - `__tests__/cli.spec.js`にテストケースを追加
3. **テストを実行** - `npm test`で新しいテストが失敗することを確認
4. **実装** - `src/cli.js`にテストを通すための最小限のコードを追加
5. **確認** - `npm test`を再度実行してすべてのテストが合格することを確認
6. **ドキュメント化** - 新しいコマンドを追加する場合はREADME.mdを更新

### タスク3: バグの修正
1. **再現** - バグを示すテストを書く
2. **失敗を確認** - `npm test`を実行してバグが存在することを確認
3. **修正** - `src/cli.js`のコードを修正して問題を解決
4. **確認** - `npm test`を実行してすべてのテストが合格することを確認

### タスク4: リファクタリング
1. **テストが合格することを確認** - 最初に`npm test`を実行
2. **リファクタリング** - コード構造/品質を改善
3. **確認** - 各変更後に`npm test`を実行
4. **コミット** - すべてのテストがまだ合格している場合のみコミット

## ファイルの場所
- **テスト**: `__tests__/cli.spec.js`
- **実装**: `src/cli.js`
- **エントリーポイント**: `bin/cli.js`
- **ドキュメント**: `README.md`

## テストコマンド
```bash
npm test              # すべてのテストを一度実行
npm run test:watch    # ウォッチモードでテストを実行
node bin/cli.js       # CLIを手動でテスト
```

## コード品質基準
- `var`の代わりに`const`と`let`を使用
- 適切な場面でアロー関数を使用
- 明確性のために必要な場合にのみコメントを追加
- 既存のコードスタイルとパターンに従う
- 関数を単一責任に焦点を絞る

## 一般的なパターン

### 新しいCLIオプションの追加:
1. `__tests__/cli.spec.js`にテストケースを追加:
```javascript
test('should do something with --option', () => {
  const output = execSync(`node ${cliPath} --option arg`).toString();
  expect(output).toContain('Expected output');
});
```

2. `src/cli.js`のswitch文にcaseを追加:
```javascript
case '--option':
  if (args[1]) {
    doSomething(args[1]);
  } else {
    console.error('Error: --option requires an argument');
    process.exit(1);
  }
  break;
```

3. `src/cli.js`に関数を追加:
```javascript
function doSomething(arg) {
  console.log(`Result: ${arg}`);
}
```

4. 関数をエクスポートし、必要に応じてヘルプテキストを更新

## 成功基準
- ✅ すべてのテストが合格（`npm test`が0を返す）
- ✅ コードが既存のパターンに従っている
- ✅ 変更が最小限で焦点を絞っている
- ✅ 必要に応じてドキュメントが更新されている
- ✅ 不要なファイルがコミットされていない

## 避けるべきアンチパターン
- ❌ テストを書く前に実装する
- ❌ テスト実行をスキップする
- ❌ テストコードサイクル外で変更を行う
- ❌ 正当な理由なく依存関係を追加する
- ❌ 既存機能を壊す
